---
title: "Wallets (SDK)"
description: "Operaciones de wallet con el SDK"
---

## Crear Wallet

```typescript
const wallet = await pan.wallet.create({
  userId: 'usuario_123',
  chainType: 'ethereum',              // Opcional: 'ethereum' | 'tron' (default: 'ethereum')
  email: 'usuario@ejemplo.com',       // Opcional
  metadata: {                          // Opcional
    nombre: 'Juan Perez',
    plan: 'premium'
  }
});

console.log(wallet.id);        // pan_wallet_abc123
console.log(wallet.address);   // 0x742d35Cc...
console.log(wallet.chainType); // ethereum
console.log(wallet.chains);    // ['ethereum', 'arbitrum', 'base']
```

### Tipos

```typescript
interface CreateWalletParams {
  userId: string;
  chainType?: 'ethereum' | 'tron';
  email?: string;
  metadata?: Record<string, unknown>;
}

interface Wallet {
  id: string;
  address: string;
  chainType: 'ethereum' | 'tron';
  chains: string[];
  createdAt: string;
}
```

## Obtener Wallet

```typescript
const wallet = await pan.wallet.get('usuario_123');

console.log(wallet.address);
console.log(wallet.chainType); // 'ethereum' | 'tron'
console.log(wallet.chains);    // Chains soportadas por esta wallet
```

## Obtener Balances

```typescript
const balances = await pan.wallet.getBalances('pan_wallet_abc123');

console.log('Total USD:', balances.totalValueUsd);

// Iterar por chain
for (const chainData of balances.chains) {
  for (const token of chainData.tokens) {
    console.log(`${chainData.chain}: ${token.balanceFormatted} ${token.asset}`);
  }
}
```

### Tipos

```typescript
interface WalletBalances {
  walletId: string;
  address: string;
  chains: ChainBalance[];
  totalValueUsd?: number;
}

interface ChainBalance {
  chain: string;
  tokens: TokenBalance[];
}

interface TokenBalance {
  asset: string;
  balance: string;
  balanceFormatted: string;
  decimals: number;
  valueUsd?: number;
}
```

## Helpers

### Calcular Total de un Asset

```typescript
function getTotalBalance(balances: WalletBalances, asset: string): number {
  let total = 0;

  for (const chainData of balances.chains) {
    const token = chainData.tokens.find(t => t.asset === asset);
    if (token) {
      total += parseFloat(token.balanceFormatted);
    }
  }

  return total;
}

// Uso
const balances = await pan.wallet.getBalances(walletId);
const totalUsdc = getTotalBalance(balances, 'USDC');
console.log('Total USDC:', totalUsdc);
```

### Verificar Fondos Suficientes

```typescript
function hasSufficientFunds(
  balances: WalletBalances,
  asset: string,
  required: number
): boolean {
  return getTotalBalance(balances, asset) >= required;
}

// Uso
if (!hasSufficientFunds(balances, 'USDC', 1000)) {
  throw new Error('Fondos insuficientes');
}
```

## Patr√≥n: Obtener o Crear

```typescript
async function getOrCreateWallet(userId: string) {
  try {
    return await pan.wallet.get(userId);
  } catch (error) {
    if (error.code === 'NOT_FOUND') {
      return await pan.wallet.create({ userId });
    }
    throw error;
  }
}
```

## Hook de React

```typescript
import { useState, useEffect, useCallback } from 'react';
import { usePan } from './usePan';
import type { Wallet, WalletBalances } from '@odisea-labs/pan';

export function useWallet(userId: string) {
  const pan = usePan();
  const [wallet, setWallet] = useState<Wallet | null>(null);
  const [balances, setBalances] = useState<WalletBalances | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  const load = useCallback(async () => {
    try {
      setLoading(true);
      const w = await pan.wallet.get(userId);
      setWallet(w);

      const b = await pan.wallet.getBalances(w.id);
      setBalances(b);
    } catch (err) {
      if (err.code !== 'NOT_FOUND') {
        setError(err);
      }
    } finally {
      setLoading(false);
    }
  }, [pan, userId]);

  useEffect(() => {
    load();
  }, [load]);

  const create = async () => {
    const w = await pan.wallet.create({ userId });
    setWallet(w);
    return w;
  };

  const refresh = async () => {
    if (!wallet) return;
    const b = await pan.wallet.getBalances(wallet.id);
    setBalances(b);
  };

  return {
    wallet,
    balances,
    loading,
    error,
    create,
    refresh,
    hasWallet: !!wallet
  };
}
```
