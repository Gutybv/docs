---
title: "Yields (SDK)"
description: "Consultar APYs con el SDK"
---

## Obtener Yields

```typescript
const yields = await pan.yields.getAll();

console.log('Mejor APY:', yields.best.apy, '%');
console.log('Protocolo:', yields.best.protocol);  // 'aave' | 'morpho'
console.log('En chain:', yields.best.chain);
```

## Estructura de Respuesta

```typescript
interface AllYieldsResponse {
  chains: string[];
  assets: string[];
  rates: Rate[];
  best: BestRate;
  updatedAt: string;
}

interface Rate {
  chain: string;
  asset: string;
  apy: number;
  protocol: 'aave' | 'morpho';
  vaultAddress?: string;   // Direcci√≥n del vault (Morpho)
  tvlUsd?: number;         // Total Value Locked en USD (Morpho)
}

interface BestRate {
  chain: string;
  asset: string;
  apy: number;
  protocol: 'aave' | 'morpho';
  vaultAddress?: string;
  tvlUsd?: number;
  reasoning: string;
}
```

<Note>
  Los yields se obtienen de **Aave V3** y **Morpho** en tiempo real. Los rates de Morpho incluyen `vaultAddress` y `tvlUsd` adicionales.
</Note>

## Listar Yields

```typescript
const { rates, best } = await pan.yields.getAll();

// Ordenar por APY (ya vienen ordenados)
rates.forEach(y => {
  const isBest = y.chain === best.chain && y.protocol === best.protocol ? ' (MEJOR)' : '';
  console.log(`${y.protocol} ${y.chain} ${y.asset}: ${y.apy.toFixed(2)}%${isBest}`);
});
```

## Helpers

### Rate por Chain y Protocolo

```typescript
function getRateForChain(yields: AllYieldsResponse, chain: string, protocol?: string): Rate | undefined {
  return yields.rates.find(y =>
    y.chain === chain && (!protocol || y.protocol === protocol)
  );
}

const baseAaveRate = getRateForChain(yields, 'base', 'aave');
const baseMorphoRate = getRateForChain(yields, 'base', 'morpho');
console.log('Base Aave APY:', baseAaveRate?.apy);
console.log('Base Morpho APY:', baseMorphoRate?.apy);
```

### Calcular Ganancias

```typescript
function calculateEarnings(
  amount: number,
  apy: number,
  days: number
): { finalAmount: number; earnings: number } {
  const dailyRate = apy / 365 / 100;
  const finalAmount = amount * Math.pow(1 + dailyRate, days);
  const earnings = finalAmount - amount;

  return { finalAmount, earnings };
}

// Uso
const { earnings } = calculateEarnings(1000, 8.52, 365);
console.log('Ganancia anual:', earnings.toFixed(2)); // ~88.97
```

## Hook de React

```typescript
import { useState, useEffect, useCallback } from 'react';
import { usePan } from './usePan';
import type { AllYieldsResponse } from '@odisea-labs/pan';

interface UseYieldsOptions {
  autoRefresh?: boolean;
  refreshInterval?: number;
}

export function useYields(options: UseYieldsOptions = {}) {
  const { autoRefresh = false, refreshInterval = 300000 } = options; // 5 min default
  const pan = usePan();

  const [yields, setYields] = useState<AllYieldsResponse | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  const fetch = useCallback(async () => {
    try {
      const data = await pan.yields.getAll();
      setYields(data);
      setError(null);
    } catch (err) {
      setError(err);
    } finally {
      setLoading(false);
    }
  }, [pan]);

  useEffect(() => {
    fetch();
  }, [fetch]);

  useEffect(() => {
    if (!autoRefresh) return;

    const timer = setInterval(fetch, refreshInterval);
    return () => clearInterval(timer);
  }, [autoRefresh, refreshInterval, fetch]);

  return {
    rates: yields?.rates || [],
    best: yields?.best,
    chains: yields?.chains || [],
    assets: yields?.assets || [],
    loading,
    error,
    refresh: fetch
  };
}
```

```tsx
// Uso
function YieldsDisplay() {
  const { rates, best, loading } = useYields({ autoRefresh: true });

  if (loading) return <div>Cargando yields...</div>;

  return (
    <div>
      {best && (
        <div className="best-yield">
          Mejor: {best.apy.toFixed(2)}% en {best.chain} ({best.protocol})
        </div>
      )}

      <table>
        <thead>
          <tr>
            <th>Chain</th>
            <th>Protocolo</th>
            <th>Asset</th>
            <th>APY</th>
          </tr>
        </thead>
        <tbody>
          {rates.map(y => (
            <tr key={`${y.chain}-${y.protocol}-${y.asset}`}>
              <td>{y.chain}</td>
              <td>{y.protocol}</td>
              <td>{y.asset}</td>
              <td>{y.apy.toFixed(2)}%</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```
