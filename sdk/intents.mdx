---
title: "Intents (SDK)"
description: "Crear y monitorear intents con el SDK"
---

## Crear Intent de Lending

```typescript
const intent = await pan.lend({
  walletId: 'pan_wallet_abc123',
  amount: 1000,
  network: 'testnet'  // Opcional, default: red configurada en el cliente
});

console.log('Intent:', intent.id);
console.log('Estado:', intent.status);
console.log('Estrategia:', intent.executionPlan.strategy);
```

## Crear Intent de Withdraw

```typescript
const intent = await pan.withdraw({
  walletId: 'pan_wallet_abc123',
  amount: 500,
  asset: 'USDC',      // Opcional, default: 'USDC'
  chain: 'base',       // Requerido
  network: 'testnet'   // Opcional
});
```

## Crear Intent de Bridge

```typescript
const intent = await pan.bridge({
  walletId: 'pan_wallet_abc123',
  amount: 500,
  asset: 'USDC',                  // Opcional, default: 'USDC'
  fromChain: 'arbitrum-sepolia',   // Requerido
  toChain: 'base-sepolia',        // Requerido
  network: 'testnet'              // Opcional
});
```

## Crear Intent de Transfer

Transfiere tokens a una dirección externa:

```typescript
const intent = await pan.transfer({
  walletId: 'pan_wallet_abc123',
  to: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb',
  amount: 100,
  asset: 'USDC',
  chain: 'arbitrum-sepolia',
  network: 'testnet'
});
```

<Warning>
  **Transfer** envia tokens fuera de la wallet pan. Verifica la dirección destino antes de ejecutar.
</Warning>

## Obtener Estado

```typescript
const intent = await pan.getIntent('intent_xyz789');

console.log('Estado:', intent.status);
console.log('Estrategia:', intent.strategy);
console.log('Gas total:', intent.totalGasCostUsd);
```

## Tipos

```typescript
// Parámetros de entrada
interface LendIntentParams {
  walletId: string;
  amount: number;
  network?: 'mainnet' | 'testnet';
}

interface WithdrawIntentParams {
  walletId: string;
  amount: number;
  asset?: string;
  chain: string;  // Requerido
  network?: 'mainnet' | 'testnet';
}

interface BridgeIntentParams {
  walletId: string;
  amount: number;
  asset?: string;
  fromChain: string;  // Requerido
  toChain: string;    // Requerido
  network?: 'mainnet' | 'testnet';
}

interface TransferIntentParams {
  walletId: string;
  to: string;         // Dirección destino
  amount: number;
  asset?: string;
  chain: string;      // Requerido
  network?: 'mainnet' | 'testnet';
}

// Respuesta de creación de intent
interface CreateIntentResponse {
  id: string;
  status: string;
  executionPlan: ExecutionPlan;
  estimatedGas?: number;
}

// Intent completo (al consultar estado)
interface Intent {
  id: string;
  status: 'pending' | 'planning' | 'executing' | 'completed' | 'failed' | 'awaiting_confirmation';
  action: string;
  amount: number;
  strategy?: string;
  steps?: number;
  bridge?: {
    fromChain: string;
    toChain: string;
    inputAmount: number;
    outputAmount: number;
    fees: number;
    txHash: string;
    fillStatus: string;
  } | null;
  deposit?: {
    chain: string;
    protocol: string;
    amount: number;
    txHash: string;
  } | null;
  totalGasUsed?: number;
  totalGasCostUsd?: number;
  createdAt: string;
  completedAt?: string;
  error?: string;
}

// Plan de ejecución
interface ExecutionPlan {
  strategy: 'direct-deposit' | 'bridge-and-lend' | 'multi-bridge-and-lend' | 'simple-withdraw' | 'bridge-only';
  steps: ExecutionStep[];
  estimatedGas?: number;
  estimatedTime?: number;
  reasoning: string;
}

// Tipos de pasos
type ExecutionStepType =
  | 'deposit' | 'withdraw' | 'swap' | 'bridge' | 'consolidate'
  | 'confidential-wrap' | 'confidential-transfer' | 'confidential-unwrap';

interface ExecutionStep {
  type: ExecutionStepType;
}

interface DepositStep extends ExecutionStep {
  type: 'deposit';
  protocol: 'aave' | 'compound' | 'morpho';
  asset: string;
  amount: number;
  chain: string;
  vaultAddress?: string;  // Para Morpho
}

interface WithdrawStep extends ExecutionStep {
  type: 'withdraw';
  protocol: 'aave' | 'compound' | 'morpho';
  asset: string;
  amount: number;
  chain: string;
  vaultAddress?: string;
}

interface BridgeStep extends ExecutionStep {
  type: 'bridge';
  fromChain: string;
  toChain: string;
  asset: string;
  amount: number;
  bridge?: 'across' | 'stargate' | 'best';
}

interface SwapStep extends ExecutionStep {
  type: 'swap';
  from: string;
  to: string;
  amount: number;
  chain: string;
  maxSlippage?: number;
  dex?: '1inch' | 'uniswap' | 'best';
}
```

## Esperar Completacion

```typescript
async function waitForIntent(intentId: string): Promise<Intent> {
  while (true) {
    const intent = await pan.getIntent(intentId);

    if (intent.status === 'completed') {
      return intent;
    }

    if (intent.status === 'failed') {
      throw new Error(intent.error || 'Intent failed');
    }

    await new Promise(r => setTimeout(r, 5000));
  }
}

// Uso
const intent = await pan.lend({ walletId, amount: 1000 });
const result = await waitForIntent(intent.id);
console.log('Completado! Gas:', result.totalGasCostUsd);
```

## Con Callback de Progreso

```typescript
async function executeWithProgress(
  params: LendIntentParams,
  onProgress: (intent: Intent) => void
): Promise<Intent> {
  const created = await pan.lend(params);

  let current = await pan.getIntent(created.id);
  onProgress(current);

  while (current.status !== 'completed' && current.status !== 'failed') {
    await new Promise(r => setTimeout(r, 5000));
    current = await pan.getIntent(created.id);
    onProgress(current);
  }

  return current;
}

// Uso
const result = await executeWithProgress(
  { walletId, amount: 1000 },
  (intent) => {
    console.log(`Estado: ${intent.status}`);
  }
);
```

## Hook de React

```typescript
import { useState, useCallback } from 'react';
import { usePan } from './usePan';
import type { LendIntentParams } from '@odisea-labs/pan';

export function useIntent() {
  const pan = usePan();
  const [intent, setIntent] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  const execute = useCallback(async (params: LendIntentParams) => {
    try {
      setLoading(true);
      setError(null);

      // Crear intent
      const created = await pan.lend(params);
      let current = await pan.getIntent(created.id);
      setIntent(current);

      // Monitorear
      while (current.status !== 'completed' && current.status !== 'failed') {
        await new Promise(r => setTimeout(r, 5000));
        current = await pan.getIntent(created.id);
        setIntent(current);
      }

      if (current.status === 'failed') {
        throw new Error(current.error || 'Intent failed');
      }

      return current;
    } catch (err) {
      setError(err);
      throw err;
    } finally {
      setLoading(false);
    }
  }, [pan]);

  return {
    intent,
    loading,
    error,
    execute,
    status: intent?.status
  };
}
```

```tsx
// Uso en componente
function LendButton({ walletId }) {
  const { execute, loading, status } = useIntent();

  const handleLend = async () => {
    try {
      const result = await execute({
        walletId,
        amount: 1000
      });
      console.log('Completado!', result);
    } catch (err) {
      console.error('Error:', err);
    }
  };

  return (
    <div>
      <button onClick={handleLend} disabled={loading}>
        {loading ? 'Procesando...' : 'Depositar'}
      </button>
      {status && <p>Estado: {status}</p>}
    </div>
  );
}
```
