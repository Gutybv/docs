---
title: "Errores (SDK)"
description: "Manejo de errores con el SDK"
---

## Clase PanError

El SDK lanza `PanError` para todos los errores de API:

```typescript
import { Pan, PanError } from '@odisea-labs/pan';

try {
  const wallet = await pan.wallet.get('usuario_inexistente');
} catch (error) {
  if (error instanceof PanError) {
    console.log('Codigo:', error.code);        // NOT_FOUND
    console.log('Mensaje:', error.message);    // Wallet not found
    console.log('Status:', error.statusCode);  // 404
    console.log('Detalles:', error.details);   // { error: '...', message: '...' }
  }
}
```

## Estructura

```typescript
class PanError extends Error {
  code: string;           // Código de error (ej: 'UNAUTHORIZED', 'NOT_FOUND')
  statusCode: number;     // Código HTTP
  message: string;        // Mensaje legible
  details?: {             // Datos del error del servidor
    error?: string;
    message?: string;
    statusCode?: number;
  };
}
```

## Códigos Comunes

| Código | Status | Descripción |
|--------|--------|-------------|
| `UNAUTHORIZED` | 401 | API key inválida o faltante |
| `NOT_FOUND` | 404 | Wallet o intent no encontrado |
| `VALIDATION_ERROR` | 400 | Request inválido (campos faltantes) |
| `UNSUPPORTED_ACTION` | 400 | Acción de intent no soportada |
| `INVALID_NETWORK` | 400 | Network debe ser 'mainnet' o 'testnet' |
| `WALLET_LIMIT_EXCEEDED` | 429 | Límite de wallets del plan alcanzado |
| `PLANNING_ERROR` | 400 | Error al planificar intent |
| `INTERNAL_ERROR` | 500 | Error interno del servidor |

## Manejo por Tipo

```typescript
import { Pan, PanError } from '@odisea-labs/pan';

async function createWalletSafe(userId: string) {
  try {
    return await pan.wallet.create({ userId });
  } catch (error) {
    if (!(error instanceof PanError)) throw error;

    switch (error.code) {
      case 'WALLET_LIMIT_EXCEEDED':
        throw new Error('Limite de wallets alcanzado. Actualiza tu plan.');

      case 'UNAUTHORIZED':
        throw new Error('Error de autenticación. Verifica tu API key.');

      case 'VALIDATION_ERROR':
        throw new Error(`Datos invalidos: ${error.message}`);

      default:
        throw error;
    }
  }
}
```

## Patron Try-Catch

```typescript
async function ejecutarConManejo(fn: () => Promise<any>) {
  try {
    return await fn();
  } catch (error) {
    if (error instanceof PanError) {
      // Error de API conocido
      handlePanError(error);
    } else if (error.name === 'TypeError' || error.message?.includes('Network')) {
      // Error de red
      throw new Error('Error de conexión. Verifica tu internet.');
    } else {
      // Error desconocido
      console.error('Error inesperado:', error);
      throw error;
    }
  }
}

function handlePanError(error: PanError) {
  switch (error.statusCode) {
    case 400:
      throw new Error(`Solicitud invalida: ${error.message}`);
    case 401:
      throw new Error('Sesion expirada. Inicia sesion nuevamente.');
    case 404:
      throw new Error('Recurso no encontrado.');
    case 429:
      throw new Error('Demasiadas solicitudes. Intenta en un momento.');
    case 500:
      throw new Error('Error del servidor. Intenta más tarde.');
    default:
      throw error;
  }
}
```

## Hook de React para Errores

```typescript
import { useState, useCallback } from 'react';
import { PanError } from '@odisea-labs/pan';

interface ErrorState {
  message: string;
  code?: string;
  retry?: () => void;
}

export function usePanError() {
  const [error, setError] = useState<ErrorState | null>(null);

  const handleError = useCallback((err: unknown, retryFn?: () => void) => {
    if (err instanceof PanError) {
      const messages: Record<string, string> = {
        UNAUTHORIZED: 'Error de autenticación',
        NOT_FOUND: 'Recurso no encontrado',
        VALIDATION_ERROR: 'Datos invalidos',
        WALLET_LIMIT_EXCEEDED: 'Limite de wallets alcanzado'
      };

      setError({
        message: messages[err.code] || err.message,
        code: err.code,
        retry: retryFn
      });
    } else {
      setError({
        message: 'Error inesperado. Intenta de nuevo.'
      });
    }
  }, []);

  const clearError = useCallback(() => setError(null), []);

  return { error, handleError, clearError };
}
```

```tsx
// Uso
function WalletCreate() {
  const pan = usePan();
  const { error, handleError, clearError } = usePanError();

  const create = async () => {
    try {
      clearError();
      await pan.wallet.create({ userId: 'user_123' });
    } catch (err) {
      handleError(err, create);
    }
  };

  return (
    <div>
      <button onClick={create}>Crear Wallet</button>
      {error && (
        <div className="error">
          <p>{error.message}</p>
          {error.retry && (
            <button onClick={error.retry}>Reintentar</button>
          )}
        </div>
      )}
    </div>
  );
}
```
